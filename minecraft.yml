- name: Installation serveur minecraft
  hosts: lxc_containers
  remote_user: root
  vars:
     user: minecraft

  tasks:
    - name: Installation paquet
      apt: name={{ item }} update_cache=yes
      with_items:
        - screen
        - nano
        - wget
        - git
    - name: Telechargement openjdk
      ansible.builtin.get_url:
        url: https://download.oracle.com/java/21/latest/jdk-21_linux-x64_bin.deb
        dest: /home/java
    - name: Installation openjdk
      ansible.builtin.apt:
        deb: /home/java
      become: true
    - name: Creation utilisateur
      user: name={{ user }}
    - name: Ajout de la clef ssh
      ansible.builtin.authorized_key: user={{ user }} key="{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
    - name: Creation dossier serveur
      ansible.builtin.file:
        path: /home/minecraft/server
        state: directory
        mode: '0755'
        owner: minecraft
        group: minecraft
    - name: Installation minecraft server
      ansible.builtin.get_url:
        url: https://piston-data.mojang.com/v1/objects/95495a7f485eedd84ce928cef5e223b757d2f764/server.jar
        dest: /home/minecraft/server
    - name: Creation fichier eula
      copy:
        dest: /home/minecraft/server/eula.txt
        content: 'eula=true'